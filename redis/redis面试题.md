面试官： 你来讲一下redis如何搭建建群吧

me：搭建集群巴拉巴拉扒拉

面试官：

https://blog.csdn.net/lxw1844912514/article/details/103115527

#### redis的如何来实现分布式锁

​		单机模式下可以使用SET key  value NX PX 30000  先查看有无再去set值和设置过期时间 这是个原子操作，在删除的时候可以使用lua脚本语言保证删除过程的原子性，在删除的时候要先判断value值是否一样，集群模式下使用redlocl去实现分布式锁



#### Redis中字符串类型的Value最多可以容纳的数据长度是512M



#### 如何保证redis和db的一致性

先更新数据库，再去删除redis



#### 什么是redis，简述优缺点

redis是基于内存存储的nosql数据库，

具有丰富的数据结构

提供持久化和事务



#### redis支持哪几种数据类型

string list hash set zset



### redis消耗什么资源

内存



####redis是单线程为什么还这么快

- 采用了多路IO复用，多路指的是多个连接，复用是使用同一个线程
- 基于内存



####redis的持久化

rdb和aof



####redis的事务

单独隔离的操作，事务不保证原子性

watch unwatch mulit exec discard



####redis的集群怎么做

集群模式三主三从

哨兵模式一主二从三哨兵



#### 集群模式和哨兵模式的区别

哨兵模式

- 监控主从服务之间是否正常
- 自动故障转移，在主机宕掉的时候，可以通过选举产生新的主机
- 节点都是全量储存

**cluster**集群模式

- 最大化利用内存，分布式存储
- 至少需要三主三从，两台主机的话，无法确定是自身有问题还是对方有问题，所以至少需要三台主机，而从机是因为为了数据安全采用的备用服务器
- 不需要配置主从，集群会自动选择主从
- 解决了单机Redis容量有限的问题



####如何保证都是热点数据

redis内存数据集大小上升到一定大小的时候，就会施行数据淘汰策略。



#### Redis对于过期键有三种清除策略：

- 被动删除：当读/写一个已经过期的key时，会触发惰性删除策略，直接删除掉这个过期key
- 主动删除：由于惰性删除策略无法保证冷数据被及时删掉，所以Redis会定期主动淘汰一批已过期的key
- 当前已用内存超过maxmemory限定时，触发**主动清理策略**



####redis的数据淘汰策略**（**当前已用内存超过maxmemory限定时，主动清理策略）

**noeviction**:返回错误当内存限制达到并且客户端尝试执行会让更多内存被使用的命令（大部分的写入指令，但DEL和几个例外） 

**allkeys-lru**: 尝试回收最少使用的键（LRU），使得新添加的数据有空间存放。

**volatile-lru**: 尝试回收最少使用的键（LRU），但仅限于在过期集合的键,使得新添加的数据有空间存放。

**allkeys-random**: 回收随机的键使得新添加的数据有空间存放。

**volatile-random**: 回收随机的键使得新添加的数据有空间存放，但仅限于在过期集合的键。

**volatile-ttl**: 回收在过期集合的键，并且优先回收存活时间（TTL）较短的键,使得新添加的数据有空间存放。



####redis使用场景

会话缓存

发布订阅

队列



####Redis key的过期时间和永久有效分别怎么设置？**

exprire和persist

reids分区



####在做缓存设计或者缓存应用时经常遇到的概念，也是缓存应用过程中必须熟知及知道 的东西。

**缓存雪崩**： 在大量redis突然失效的时候，请求在缓存无法获取进而去访问数据库，数据库压力过大导致服务器宕机的行为 解决方法：尽量保证大量的key的失效时间不在同一时间段内，保证缓存的高可用，避免单点缓存宕机

**缓存穿透**：就是当我们的缓存没有查询到数据的时候会去查找数据库，但是数据库也没有这条数据，这时候如果大量查询这个不存在的数据的时候会导致数据库崩溃，这就是缓存穿透 解决方法:我们可以将查询不到的数据放在我们的缓存当中，并且设置他的过期时间为60秒，较短的时间，这样在短时间内查询的时候都回去访问缓存

**缓存预热**：在系统上线前，把一些热点数据放进缓存当中

缓存热备是



**Redis protected-mode属性解读**
**redis3.2版本后新增protected-mode配置，默认是yes，即开启。设置外部网络连接redis服务，设置方式如下：**

**1、关闭protected-mode模式，此时外部网络可以直接访问**

**2、开启protected-mode保护模式，需配置bind ip或者设置访问密码**



外网连接redis

1.关闭防火墙或者打开端口

2.修改配置文件bind 注释掉或者修改

3.protected-mode yes    把yes改为no 这是是否允许















